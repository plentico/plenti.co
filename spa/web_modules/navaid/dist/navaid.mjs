import convert from"../../regexparam/dist/regexparam.mjs";export default function(t,n){var o,a,i=[],s={},r=s.format=function(e){return e&&(e="/"+e.replace(/^\/|\/$/g,""),o.test(e)&&e.replace(o,"/"))};return t="/"+(t||"").replace(/^\/|\/$/g,""),o=t=="/"?/^\/+/:new RegExp("^\\"+t+"(?=\\/|$)\\/?","i"),s.route=function(e,n){e[0]=="/"&&!o.test(e)&&(e=t+e),history[(e===a||n?"replace":"push")+"State"](e,null,e)},s.on=function(e,t){return(e=convert(e)).fn=t,i.push(e),s},s.run=function(e){var o,l,t=0,c={};if(e=r(e||location.pathname)){e=e.match(/[^?#]*/)[0];for(a=e;t<i.length;t++)if(l=(o=i[t]).pattern.exec(e)){for(t=0;t<o.keys.length;)c[o.keys[t]]=l[++t]||null;return o.fn(c),s}n&&n(e)}return s},s.listen=function(e){wrap("push"),wrap("replace");function t(){s.run()}function n(e){var n=e.target.closest("a"),t=n&&n.getAttribute("href");if(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button||e.defaultPrevented)return;if(!t||n.target||n.host!==location.host||t[0]=="#")return;(t[0]!="/"||o.test(t))&&(e.preventDefault(),s.route(t))}return addEventListener("popstate",t),addEventListener("replacestate",t),addEventListener("pushstate",t),addEventListener("click",n),s.unlisten=function(){removeEventListener("popstate",t),removeEventListener("replacestate",t),removeEventListener("pushstate",t),removeEventListener("click",n)},s.run(e)},s}function wrap(e,t){if(history[e])return;history[e]=e,t=history[e+="State"],history[e]=function(n){var s=new Event(e.toLowerCase());return s.uri=n,t.apply(this,arguments),dispatchEvent(s)}}