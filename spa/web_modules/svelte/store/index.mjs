import{noop,safe_not_equal,subscribe,run_all,is_function}from"../internal/index.mjs";export{get_store_value as get}from"../internal/index.mjs";const subscriber_queue=[];function readable(e,t){return{subscribe:writable(e,t).subscribe}}function writable(e,t=noop){let s;const n=[];function o(t){if(safe_not_equal(e,t)&&(e=t,s)){const t=!subscriber_queue.length;for(let t=0;t<n.length;t+=1){const s=n[t];s[1](),subscriber_queue.push(s,e)}if(t){for(let e=0;e<subscriber_queue.length;e+=2)subscriber_queue[e][0](subscriber_queue[e+1]);subscriber_queue.length=0}}}function i(t){o(t(e))}function a(i,a=noop){const r=[i,a];return n.push(r),n.length===1&&(s=t(o)||noop),i(e),()=>{const e=n.indexOf(r);e!==-1&&n.splice(e,1),n.length===0&&(s(),s=null)}}return{set:o,update:i,subscribe:a}}function derived(e,t,n){const s=!Array.isArray(e),o=s?[e]:e,i=t.length<2;return readable(n,e=>{let c=!1;const n=[];let a=0,r=noop;const l=()=>{if(a)return;r();const o=t(s?n[0]:n,e);i?e(o):r=is_function(o)?o:noop},d=o.map((e,t)=>subscribe(e,e=>{n[t]=e,a&=~(1<<t),c&&l()},()=>{a|=1<<t}));return c=!0,l(),function(){run_all(d),r()}})}export{derived,readable,writable}