import{SvelteComponent,check_outros,claim_component,component_subscribe,create_component,destroy_component,detach,empty,group_outros,init,insert,mount_component,safe_not_equal,transition_in,transition_out}from"../web_modules/svelte/internal/index.mjs";import Navaid from"../web_modules/navaid/dist/navaid.mjs";import allContent from"./content.js";import*as allLayouts from"./layouts.js";import{env}from"./env.js";import adminMenu from"./cms/admin_menu.js";import{user}from"./cms/auth.js";import allDefaults from"./defaults.js";function create_fragment(e){let t,s,o;var n=allLayouts["layouts_"+env.entrypoint.replace("/","_").replace(".","_")];function i(e){return{props:{path:e[0],params:e[1],content:e[2],layout:e[3],allContent,allLayouts,env,user,adminMenu,shadowContent:e[4]}}}return n&&(t=new n(i(e))),{c(){t&&create_component(t.$$.fragment),s=empty()},l(e){t&&claim_component(t.$$.fragment,e),s=empty()},m(e,n){t&&mount_component(t,e,n),insert(e,s,n),o=!0},p(e,[o]){const a={};if(o&1&&(a.path=e[0]),o&2&&(a.params=e[1]),o&4&&(a.content=e[2]),o&8&&(a.layout=e[3]),n!==(n=allLayouts["layouts_"+env.entrypoint.replace("/","_").replace(".","_")])){if(t){group_outros();const e=t;transition_out(e.$$.fragment,1,0,()=>{destroy_component(e,1)}),check_outros()}n?(t=new n(i(e)),create_component(t.$$.fragment),transition_in(t.$$.fragment,1),mount_component(t,s.parentNode,s)):t=null}else n&&t.$set(a)},i(e){if(o)return;t&&transition_in(t.$$.fragment,e),o=!0},o(e){t&&transition_out(t.$$.fragment,e),o=!1},d(e){e&&detach(s),t&&destroy_component(t,e)}}}function instance(e,t,n){let o;component_subscribe(e,user,e=>n(5,o=e));let d=location.pathname,c=new URLSearchParams(location.search),s=allContent.find(e=>e.filepath===document.documentElement.dataset.contentFilepath),r,h={};o.isBeingAuthenticated&&o.finishAuthentication(c);function l(e,t){n(2,s=t),s===void 0&&(n(2,s=allContent.find(e=>e.filepath==="content/404.json")),s===void 0&&n(2,s={path:"/404",type:"404",filename:"404.json",fields:{}})),n(3,r=e.default),window.scrollTo(0,0)}function a(e){n(0,d=e.state||e.uri||location.pathname),n(1,c=new URLSearchParams(location.search))}addEventListener("replacestate",a),addEventListener("pushstate",a),addEventListener("popstate",a);const i=()=>{import("../content/404.js").then(l).catch(e=>{console.log("Add a '/layouts/content/404.svelte' file to handle Page Not Found errors."),console.log("If you want to pass data to your 404 component, you can also add a '/content/404.json' file."),console.log(e)})},m=()=>{if(location.pathname!="/")return!1;if(location.hash.startsWith("#add/")&&o.isAuthenticated){const[e,t]=location.hash.substring("#add/".length).split("/"),o=allDefaults.find(t=>t.type==e);return e&&t&&o?(import("../content/"+e+".js").then(e=>{n(2,s=structuredClone(o)),n(2,s.isNew=!0,s),n(2,s.filename=t+".json",s),n(2,s.filepath=s.filepath.replace("_defaults.json",t+".json"),s),n(3,r=e.default)}).catch(i),!0):(i(),!0)}return!1},u=Navaid("/",i);return allContent.forEach(e=>{u.on(env.baseurl+e.path,()=>{if(m())return;import("../content/"+e.type+".js").then(t=>l(t,e)).catch(i)})}),u.listen(),[d,c,s,r,h]}class Component extends SvelteComponent{constructor(e){super(),init(this,e,instance,create_fragment,safe_not_equal,{})}}export default Component