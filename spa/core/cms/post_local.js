import{env}from"../../generated/env.js";import evaluateRoute from"./route_eval.js";export async function postLocal(e,t,n,s){let a="/postlocal";const r={"Content-Type":"application/json; charset=utf-8"},c=e=>e.split(",")[1];let o=[];e.forEach(e=>{o.push({action:n,action:n,encoding:s,file:e.file,contents:s==="base64"?c(e.contents):e.contents})});const i=await fetch(a,{method:"POST",headers:r,body:JSON.stringify(o)});if(i.ok){if((n==="create"||n==="update")&&(t?.onSave?.(),e.length===1&&e[0].file.lastIndexOf(".json")>0)){let t=evaluateRoute(e[0]);t!==location.pathname&&history.pushState({isNew:!0,route:t},"",t)}n==="delete"&&(t?.onDelete?.(),history.pushState(null,"",env.baseurl&&!env.local?env.baseurl:"/"))}else{const{error:e,message:t}=await i.json();throw new Error(`Publish failed: ${e||t}`)}}